<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="manifest" href="canvasdraw.webmanifest" />
		<title>Draw</title>
		<style>
			body {
				margin: 0 auto;
				overflow: hidden;
			}
			
			#canvas {
				border: solid 1px black;
				position: relative;
			}
		</style>
		<script>    
			var canvas, ctx, ball, fps = 24;
			var mouse = {down:false};
			
			var Ball = function(){
				this.lineWidth = 5;
				this.left;
				this.top;
			};

			Ball.prototype.render = function(){
				ctx.lineWidth = this.lineWidth;
				ctx.strokeStyle = 'darkorange';
				ctx.lineCap = 'round';
				ctx.lineTo(this.left, this.top);
				ctx.stroke();
			};
			
			var load = function(){
				canvas = document.getElementById('canvas');  
				if (canvas.getContext) {  
					ctx = canvas.getContext('2d');
					ball = new Ball();

					if(localStorage.getItem('img')){
						var img = new Image();
						img.addEventListener('load', function(e){
							ctx.drawImage(img, 0, 0);
						}, false);
						img.src = localStorage.getItem('img');
					}

					document.getElementById('btnclear').addEventListener('click', function(){
						localStorage.clear();
						ctx.clearRect(0, 0, canvas.width, canvas.height);
					}, false);

					canvas.addEventListener('mousemove', mousemove, false);
					canvas.addEventListener('mousedown', function(){mouse.down = true;ctx.beginPath();}, false);
					canvas.addEventListener('mouseup', function(){mouse.down = false;}, false);
				}
			};
			
			var mousemove = function(e){
				mouse.left = e.clientX-canvas.offsetLeft;
				mouse.top = e.clientY-canvas.offsetTop;
				if(mouse.down){
					ball.left = mouse.left;
					ball.top = mouse.top;
					ball.render();
				}
				localStorage.setItem('img', canvas.toDataURL());
			};
			
			document.addEventListener('DOMContentLoaded', load, false);
		</script>  
	</head>
	<body>
		<canvas id="canvas" width="400" height="600"></canvas> 
		<div>
			<button id="btnclear">Clear</button>	
		</div>
	</body>
</html>